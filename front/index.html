<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<script
			type="text/javascript"
			src="http://code.jquery.com/jquery-3.5.1.min.js"
		></script>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
		<script src="apis.js"></script>
		<script src="setUser.js"></script>
		<script src="category.js"></script>
		<link rel="stylesheet" href="css/stylesheet.css" />
		<script src="https://kit.fontawesome.com/0526cc06e5.js" crossorigin="anonymous"></script>
	</head>
	<body>
		<!-- 헤더 -->
		<nav class="navbar navbar-light bg-light">
			<div class="navbar-top">
				<a class="navbar-brand" href="index.html"
          ><img src="images/01_KT Wordmark (Standard)_01.png" alt="KT"
        /></a>
				<form class="d-flex">
					<input class="search-box search" type="search" placeholder="Search" aria-label="Search">
					<button class="btn btn-outline search-btn" type="submit">Search</button>
				</form>
				<img class="profile-image" src="" alt="" style="margin-left: auto;margin-right: 1rem;">
					<div class="dropdown">
						<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
							다른 계정
						</button>
						<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
							<li><a class="dropdown-item login" user-id="1" href="#">김보원</a></li>
							<li><a class="dropdown-item login" user-id="2" href="#">김수연</a></li>
							<li><a class="dropdown-item login" user-id="3" href="#">박찬영</a></li>
							<li><a class="dropdown-item login" user-id="4" href="#">이민재</a></li>
						</ul>
				</div>			
			</div>		 
		</nav>
		
		<nav class="navbar navbar-expand-lg navbar-light bg-light">			
			  <div class="collapse navbar-collapse" id="navbarNavDropdown">
				<ul class="navbar-nav">
				  <li class="nav-item">
					<a class="nav-link active" aria-current="page" href="index.html">홈</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link question" href="postform.html">질문하기</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" href="answer.html">답변하기</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" href="mypage.html">마이페이지</a>
				  </li>
				</ul>
			  </div>
			</div>
		</nav>


		<!-- <div class="card-list"></div> -->
		<div class="container-fluid main-box" style="background-color: #DDDDDD;">
			<div class="row justify-content-around">
				<!--1:6:1 10 -> 2 6 2느낌으로 나누고 처음 1은 이미 정해짐-->
				<div class="col-2 b">
					<p>카테고리</p>
					<div class="side-nav">
					<p class="all-click" style="cursor: pointer">전체</p>
					<span class="part-click" >부문별</span>
					<i class="fa-solid fa-angle-down rotate1 part-click"></i>
				</div>
				<div class="side-nav">
					<ul class="part"></ul>
					<span class="common-click">공통</span>
					<i class="fa-solid fa-angle-down rotate2 common-click"></i>
					<ul class="common"></ul>
					</div>
				</div>
				<div class="col-7">
					<div class="row justify-content-around card-box">
						<div class="col-md link shadow-sm" style="background-color: #3FBDB9;">
							<div class="text-box">
							<h2>기본 업무 처리할 때는?</h2><br>
							<a href="http://kate.kt.com">KATE</a>
						</div>
						</div>
						<div class="col-md link shadow-sm" style="background-color: #E0542C;">
							<div class="text-box">
							<h2>IT 프로세스 도움이 필요할 때는?</h2><br>
							<a href="http://kate.kt.com">IT's PORTAL</a>
							</div>
						</div>
						<div class="col-md link shadow-sm" style="background-color: #EC6D6D;">
							<div class="text-box">
							<h2>지식을 쌓고 싶을 때는?</h2><br>
							<a href="https://ktedu.kt.com/main/portalMain.do">GENIUS</a>
						</div>
						</div>
					</div>
					<div class="container">
						<div class="row justify-content-around" style="margin-bottom: 10px;">
						  <div class="col-md card shadow-sm">
							<p>좋아요 TOP 5</p>
							<ol class="posts top-like"></ol>
						  </div>
						  <div class="col-md card shadow-sm">
							<p>나를 위한 추천 게시글</p>
							<ol class="posts top-view"></ol>
						  </div>
						</div>
						<div class="row justify-content-around">
						  <div class="col-md card shadow-sm">
							  <p>미해결 질문</p>
								<ol class="posts unsolved"></ol>
							</div>
						  <div class="col-md card shadow-sm">
							<p>최근 올라온 질문</p>
							<ol class="posts recent"></ol>
						  </div>
						</div>
					  </div>
				</div>
				<div class="col-2 b" style="background-color: white; margin: 10px">
					<p class="myinfo">내정보</p>
				</div>
			</div>
		</div>
		

		<script>
			$(document).ready(function () {
				let posts;
				// 유저 정보
				var user = getLoginUser();
				$('.profile-image').attr('src','images/'+user.image);

				console.log(user);
				let like_top_posts, view_top_posts, unsolved_posts, recent_posts;
				setPosts();
				console.log(user);
				$('.myinfo').html(`내정보 : ${user.nickname}`);
				var part_tag = $('.part');
				part_classification.forEach((category) => {
					part_tag.append(
						$(`<li class="category" data="${category}">${category}</li>`)
					);
				});
				$('.part li').hide();
				var common_tag = $('.common');
				common_classification.forEach((category) => {
					common_tag.append(
						$(`<li class="category" data="${category}">${category}</li>`)
					);
				});
				$('.common li').hide();

				$('.question').on('click', function (e) {
					e.stopPropagation();
					window.location.href = `postform.html`;
				});
				$('.part-click').on('click', function () {
					$('.part li').toggle();
					$('.rotate1').toggleClass("down");
				});
				$('.common-click').on('click', function () {
					$('.common li').toggle();
					$('.rotate2').toggleClass('down');
				});

				$('.all-click').on('click', function() {
					setPosts();
				})
				$('.category').on('click', function () {
					setPosts(this.getAttribute('data'));
					$('.fa-angle-down').css({
							"-webkit-transform": "rotate(180deg)",
							"-moz-transform": "rotate(180deg)",
							"transform": "rotate(180deg)" 
					});
				});

				// 분야별 게시글 세팅
				function setPosts(category) {
					posts = getAllPosts(category);
					like_top_posts = [...posts];
					recommended_posts = [...posts];
					unsolved_posts = [...posts];
					recent_posts = [...posts];

					like_top_posts.sort((a, b) => {
						return b.like - a.like;
					});
					like_top_posts = like_top_posts.slice(0, 5);
					console.log('like', like_top_posts);
					recommended_posts = recommended_posts.filter(post=>{
						for(let i=0;i<user.hashtags.length;i++) {
							if(post.hashtags.includes(user.hashtags[i])) return true;
						}
						return false;
					});
					console.log('추천',recommended_posts);
					recommended_posts = recommended_posts.slice(0, 5);
					unsolved_posts = unsolved_posts.filter((post) => {
						return !post.solved;
					});
					unsolved_posts = unsolved_posts.slice(0, 5);
					recent_posts.sort((a, b) => {
						return b.id - a.id;
					});
					recent_posts = recent_posts.slice(0, 5);
					console.log('recent', recent_posts);
					$('.top-like').empty();
					$('.top-view').empty();
					$('.unsolved').empty();
					$('.recent').empty();
					like_top_posts.forEach((post) => {
						$('.top-like').append(
							$(`<li class="post" post-id="${post.id}">${post.title}</li>`)
						);
					});
					recommended_posts.forEach((post) => {
						$('.top-view').append(
							$(`<li class="post" post-id="${post.id}">${post.title}</li>`)
						);
					});
					unsolved_posts.forEach((post) => {
						$('.unsolved').append(
							$(`<li class="post" post-id="${post.id}">${post.title}</li>`)
						);
					});
					recent_posts.forEach((post) => {
						$('.recent').append(
							$(`<li class="post" post-id="${post.id}">${post.title}</li>`)
						);
					});
					$('.post').on('click', function (e) {
						console.log(e);
						let postId = e.currentTarget.getAttribute('post-id');
						console.log(postId);
						window.location.href = `post.html?postId=${postId}`;
					});
				}


				// HEADER FUNCTION

				// search 버튼 클릭
				$('.search-btn').on('click', function (e) {
					e.preventDefault();
					var hashtag = $('.search').val();
					console.log($('.search').val());
					console.log(hashtag);
					searchByHashtag(hashtag);
					window.location.href = `search.html?type=hashtag&word=${hashtag}`;
				});

				// 다른 계정 로그인
				$('.login').on('click', function() {
					// console.log(this.getAttribute('user-id'));
					var new_user = this.getAttribute('user-id');
					login(new_user);	
				})
			});
		</script>
		<script src="header.js"></script>
	</body>
</html>
